<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SwapSkill - Schedule Sessions</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: #333;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      padding: 30px 0;
      border-bottom: 2px solid #4a6cf7;
      margin-bottom: 40px;
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .logo-icon {
      font-size: 2.5rem;
      color: #4a6cf7;
    }

    .logo-text {
      font-size: 2.5rem;
      font-weight: 800;
      color: #4a6cf7;
    }

    .header h1 {
      font-size: 2.8rem;
      margin-bottom: 10px;
      color: #333;
    }

    .header p {
      color: #666;
      font-size: 1.1rem;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }

    .schedule-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      margin-bottom: 50px;
    }

    @media (max-width: 900px) {
      .schedule-container {
        grid-template-columns: 1fr;
      }
    }

    .section {
      background: white;
      padding: 30px;
      border-radius: 20px;
      border: none;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    }

    .section-title {
      font-size: 1.8rem;
      color: #333;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(74, 108, 247, 0.1);
      display: flex;
      align-items: center;
      gap: 15px;
    }

    /* Calendar Section */
    .calendar-container {
      grid-column: 1 / -1;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .month-navigation {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .nav-btn {
      background: rgba(74, 108, 247, 0.1);
      border: 1px solid rgba(74, 108, 247, 0.3);
      color: #4a6cf7;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .nav-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      transform: scale(1.1);
    }

    .current-month {
      font-size: 1.5rem;
      font-weight: 600;
      color: #333;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .day-header {
      text-align: center;
      padding: 15px;
      background: rgba(74, 108, 247, 0.1);
      border-radius: 10px;
      font-weight: 600;
      color: #4a6cf7;
    }

    .day-cell {
      background: #f9f9f9;
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 15px;
      min-height: 100px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .day-cell:hover {
      border-color: rgba(255, 215, 0, 0.3);
      transform: translateY(-2px);
    }

    .day-cell.selected {
      background: rgba(74, 108, 247, 0.05);
      border-color: #4a6cf7;
      box-shadow: 0 5px 15px rgba(74, 108, 247, 0.15);
    }

    .day-number {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 5px;
      color: #333;
    }

    .day-events {
      margin-top: 10px;
    }

    .event-dot {
      width: 8px;
      height: 8px;
      background: #4a6cf7;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
    }

    .event-text {
      font-size: 0.8rem;
      color: #666;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Time Slots */
    .time-slots-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 12px;
      margin-top: 20px;
    }

    .time-slot {
      background: #f9f9f9;
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .time-slot:hover {
      border-color: rgba(255, 215, 0, 0.3);
      transform: translateY(-2px);
    }

    .time-slot.selected {
      background: rgba(74, 108, 247, 0.05);
      border-color: #4a6cf7;
      box-shadow: 0 5px 15px rgba(74, 108, 247, 0.15);
    }

    .time-display {
      font-size: 1.1rem;
      font-weight: 600;
      color: #4a6cf7;
    }

    .slot-status {
      font-size: 0.8rem;
      color: #666;
      margin-top: 5px;
    }

    /* Session Details Form */
    .form-group {
      margin-bottom: 25px;
    }

    .form-label {
      display: block;
      margin-bottom: 10px;
      color: #4a6cf7;
      font-weight: 600;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 15px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 12px;
      color: #333;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: #4a6cf7;
      box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.1);
    }

    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }

    .duration-options {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .duration-option {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      color: #333;
    }

    .duration-option:hover {
      border-color: rgba(255, 215, 0, 0.3);
    }

    .duration-option.selected {
      background: rgba(74, 108, 247, 0.05);
      border-color: #4a6cf7;
      color: #4a6cf7;
      font-weight: 600;
    }

    /* Session Type */
    .session-type-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 10px;
    }

    .session-type {
      background: white;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
    }

    .session-type:hover {
      border-color: rgba(255, 215, 0, 0.3);
      transform: translateY(-3px);
    }

    .session-type.selected {
      background: rgba(74, 108, 247, 0.05);
      border-color: #4a6cf7;
      box-shadow: 0 5px 15px rgba(74, 108, 247, 0.15);
    }

    .session-icon {
      font-size: 2.5rem;
      color: #4a6cf7;
      margin-bottom: 10px;
    }

    /* Upcoming Sessions */
    .sessions-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .session-card {
      background: white;
      border: 1px solid #eee;
      border-radius: 15px;
      padding: 20px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
    }

    .session-card:hover {
      border-color: #4a6cf7;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(74, 108, 247, 0.1);
    }

    .session-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .session-title {
      font-size: 1.3rem;
      color: #333;
      font-weight: 700;
    }

    .session-date {
      background: rgba(74, 108, 247, 0.1);
      color: #4a6cf7;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .session-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }

    .detail-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .detail-icon {
      color: #4a6cf7;
      font-size: 1.2rem;
    }

    .session-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 15px;
    }

    .action-btn {
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
    }

    .join-btn {
      background: linear-gradient(135deg, #4a6cf7, #6a8eff);
      color: white;
      box-shadow: 0 4px 10px rgba(74, 108, 247, 0.3);
    }

    .cancel-btn {
      background: transparent;
      color: #666;
      border: 1px solid #ddd;
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    /* Submit Button */
    .submit-container {
      text-align: center;
      margin-top: 40px;
      padding-top: 30px;
      border-top: 2px solid rgba(74, 108, 247, 0.1);
    }

    .submit-btn {
      background: linear-gradient(135deg, #4a6cf7, #6a8eff);
      color: white;
      border: none;
      padding: 18px 50px;
      font-size: 1.3rem;
      font-weight: 700;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 6px 20px rgba(74, 108, 247, 0.3);
    }

    .submit-btn:hover:not(:disabled) {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(74, 108, 247, 0.4);
    }

    .submit-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: #4a6cf7;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #6a8eff;
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .calendar-grid {
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
      }

      .day-cell {
        min-height: 70px;
        padding: 10px;
      }

      .day-number {
        font-size: 1rem;
      }

      .session-type-options {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .header h1 {
        font-size: 2rem;
      }

      .logo-text {
        font-size: 2rem;
      }

      .section {
        padding: 20px;
      }

      .current-month {
        font-size: 1.2rem;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Header -->
    <div class="header" style="position: relative;">
      <a href="dashboard2.html"
        style="position: absolute; left: 0; top: 30px; text-decoration: none; color: #4a6cf7; font-weight: 600; display: flex; align-items: center; gap: 8px;">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </a>
      <div class="logo">
        <i class="fas fa-exchange-alt logo-icon"></i>
        <span class="logo-text">SWAPSKILL</span>
      </div>
      <h1>Schedule Learning Sessions</h1>
      <p>Book teaching sessions, schedule learning appointments, and manage your skill exchange calendar</p>
    </div>

    <!-- Main Schedule Container -->
    <div class="schedule-container">
      <!-- Calendar Section -->
      <div class="section calendar-container">
        <h2 class="section-title">
          <i class="fas fa-calendar-alt"></i> Select Date
        </h2>

        <div class="calendar-header">
          <div class="month-navigation">
            <button class="nav-btn" onclick="changeMonth(-1)">
              <i class="fas fa-chevron-left"></i>
            </button>
            <div class="current-month" id="currentMonth">January 2024</div>
            <button class="nav-btn" onclick="changeMonth(1)">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>

          <button class="nav-btn" onclick="goToToday()">
            <i class="fas fa-calendar-day"></i>
          </button>
        </div>

        <div class="calendar-grid" id="calendarGrid">
          <!-- Calendar headers will be generated here -->
        </div>

        <div class="selected-date-info">
          <h3 style="color: #4a6cf7; margin-bottom: 15px;">
            <i class="fas fa-clock"></i> Available Time Slots for
            <span id="selectedDateDisplay" style="color: #333;">Select a date</span>
          </h3>

          <div class="time-slots-container" id="timeSlots">
            <!-- Time slots will be generated here -->
          </div>
        </div>
      </div>

      <!-- Session Details Form -->
      <div class="section">
        <h2 class="section-title">
          <i class="fas fa-edit"></i> Session Details
        </h2>

        <div class="form-group">
          <label class="form-label">Select Subject</label>
          <select class="form-select" id="subjectSelect">
            <option value="">Choose a subject to teach/learn</option>
            <!-- Options will be populated from profile -->
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Session Type</label>
          <div class="session-type-options">
            <div class="session-type" onclick="selectSessionType('teach')">
              <div class="session-icon">
                <i class="fas fa-chalkboard-teacher"></i>
              </div>
              <div class="session-type-name">Teaching Session</div>
              <div class="session-type-desc" style="color: #666; font-size: 0.9rem; margin-top: 5px;">
                You teach someone
              </div>
            </div>

            <div class="session-type" onclick="selectSessionType('learn')">
              <div class="session-icon">
                <i class="fas fa-book-open"></i>
              </div>
              <div class="session-type-name">Learning Session</div>
              <div class="session-type-desc" style="color: #666; font-size: 0.9rem; margin-top: 5px;">
                You learn from someone
              </div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Session Duration</label>
          <div class="duration-options">
            <div class="duration-option" onclick="selectDuration(30)">30 min</div>
            <div class="duration-option" onclick="selectDuration(45)">45 min</div>
            <div class="duration-option" onclick="selectDuration(60)">60 min</div>
            <div class="duration-option" onclick="selectDuration(90)">90 min</div>
            <div class="duration-option" onclick="selectDuration(120)">120 min</div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Session Title</label>
          <input type="text" class="form-input" id="sessionTitle"
            placeholder="e.g., Introduction to Python Programming">
        </div>

        <div class="form-group">
          <label class="form-label">Session Description</label>
          <textarea class="form-textarea" id="sessionDescription"
            placeholder="Describe what will be covered in this session..."></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Preferred Language</label>
          <select class="form-select" id="languageSelect">
            <option value="english">English</option>
            <option value="hindi">Hindi</option>
            <option value="spanish">Spanish</option>
            <option value="french">French</option>
            <!-- More languages will be populated -->
          </select>
        </div>
      </div>

      <!-- Upcoming Sessions -->
      <div class="section">
        <h2 class="section-title">
          <i class="fas fa-list-alt"></i> Upcoming Sessions
        </h2>

        <div class="sessions-list" id="sessionsList">
          <!-- Sessions will be dynamically added here -->
        </div>
      </div>

      <!-- Session History -->
      <div class="section">
        <h2 class="section-title">
          <i class="fas fa-history"></i> Recent Sessions
        </h2>

        <div class="sessions-list" id="sessionHistory">
          <!-- Past sessions will be dynamically added here -->
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="submit-container">
      <button class="submit-btn" id="submitBtn" onclick="scheduleSession()">
        <i class="fas fa-calendar-check"></i> Schedule Session
      </button>
    </div>
  </div>

  <script>
    // Initialize variables
    let currentDate = new Date();
    let selectedDate = null;
    let selectedTime = null;
    let selectedDuration = 60; // Default 60 minutes
    let selectedSessionType = 'teach'; // Default to teaching
    let userSubjects = [];

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function () {
      loadUserProfile();
      generateCalendar();
      generateTimeSlots();
      loadUpcomingSessions();
      loadSessionHistory();
    });

    // Load user profile data
    function loadUserProfile() {
      try {
        const profileData = JSON.parse(localStorage.getItem('swapSkillProfile'));
        if (profileData) {
          // Combine teach and learn subjects
          userSubjects = [
            ...(profileData.teachSubjects || []),
            ...(profileData.learnSubjects || [])
          ];

          // Remove duplicates
          userSubjects = [...new Set(userSubjects)];

          // Populate subject select
          const subjectSelect = document.getElementById('subjectSelect');
          userSubjects.forEach(subject => {
            const option = document.createElement('option');
            option.value = subject;
            option.textContent = subject;
            subjectSelect.appendChild(option);
          });

          // Set default session type based on available subjects
          if (profileData.teachSubjects && profileData.teachSubjects.length > 0) {
            selectedSessionType = 'teach';
            document.querySelectorAll('.session-type')[0].classList.add('selected');
          } else if (profileData.learnSubjects && profileData.learnSubjects.length > 0) {
            selectedSessionType = 'learn';
            document.querySelectorAll('.session-type')[1].classList.add('selected');
          }
        }
      } catch (e) {
        console.log("Error loading profile:", e);
      }
    }

    // Generate calendar
    function generateCalendar() {
      const calendarGrid = document.getElementById('calendarGrid');
      calendarGrid.innerHTML = '';

      // Day headers
      const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      days.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.className = 'day-header';
        dayHeader.textContent = day;
        calendarGrid.appendChild(dayHeader);
      });

      // Get first day of month and total days
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      // Update month display
      const monthNames = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
      ];
      document.getElementById('currentMonth').textContent =
        `${monthNames[month]} ${year}`;

      // Add empty cells for days before first day of month
      for (let i = 0; i < firstDay; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'day-cell empty';
        calendarGrid.appendChild(emptyCell);
      }

      // Add days of the month
      const today = new Date();
      for (let day = 1; day <= daysInMonth; day++) {
        const dayCell = document.createElement('div');
        dayCell.className = 'day-cell';
        dayCell.onclick = () => selectDate(day);

        // Check if today
        if (year === today.getFullYear() &&
          month === today.getMonth() &&
          day === today.getDate()) {
          dayCell.style.borderColor = '#4a6cf7';
          dayCell.style.background = 'rgba(74, 108, 247, 0.05)';
        }

        // Day number
        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = day;
        dayCell.appendChild(dayNumber);

        // Add event dots (mock data - in real app, load from user's sessions)
        if (Math.random() > 0.7) { // Randomly add events for demo
          const eventsDiv = document.createElement('div');
          eventsDiv.className = 'day-events';

          const eventCount = Math.floor(Math.random() * 3) + 1;
          for (let i = 0; i < Math.min(eventCount, 2); i++) {
            const eventDiv = document.createElement('div');
            eventDiv.className = 'event-text';
            eventDiv.innerHTML = '<span class="event-dot"></span> Session';
            eventsDiv.appendChild(eventDiv);
          }

          if (eventCount > 2) {
            const moreDiv = document.createElement('div');
            moreDiv.className = 'event-text';
            moreDiv.textContent = `+${eventCount - 2} more`;
            eventsDiv.appendChild(moreDiv);
          }

          dayCell.appendChild(eventsDiv);
        }

        calendarGrid.appendChild(dayCell);
      }
    }

    // Generate time slots
    function generateTimeSlots() {
      const timeSlotsContainer = document.getElementById('timeSlots');
      timeSlotsContainer.innerHTML = '';

      const timeSlots = [
        '09:00 AM', '10:00 AM', '11:00 AM', '12:00 PM',
        '01:00 PM', '02:00 PM', '03:00 PM', '04:00 PM',
        '05:00 PM', '06:00 PM', '07:00 PM', '08:00 PM'
      ];

      timeSlots.forEach(time => {
        const timeSlot = document.createElement('div');
        timeSlot.className = 'time-slot';
        timeSlot.onclick = () => selectTime(time, timeSlot);

        const timeDisplay = document.createElement('div');
        timeDisplay.className = 'time-display';
        timeDisplay.textContent = time;

        const slotStatus = document.createElement('div');
        slotStatus.className = 'slot-status';
        slotStatus.textContent = Math.random() > 0.5 ? 'Available' : 'Booked';

        if (slotStatus.textContent === 'Booked') {
          timeSlot.style.opacity = '0.5';
          timeSlot.style.cursor = 'not-allowed';
          timeSlot.onclick = null;
        }

        timeSlot.appendChild(timeDisplay);
        timeSlot.appendChild(slotStatus);
        timeSlotsContainer.appendChild(timeSlot);
      });
    }

    // Change month
    function changeMonth(direction) {
      currentDate.setMonth(currentDate.getMonth() + direction);
      generateCalendar();
    }

    // Go to today
    function goToToday() {
      currentDate = new Date();
      generateCalendar();
      selectDate(currentDate.getDate());
    }

    // Select date
    function selectDate(day) {
      selectedDate = new Date(
        currentDate.getFullYear(),
        currentDate.getMonth(),
        day
      );

      // Update selected date display
      const dateDisplay = document.getElementById('selectedDateDisplay');
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      dateDisplay.textContent = selectedDate.toLocaleDateString('en-US', options);

      // Update calendar selection
      document.querySelectorAll('.day-cell').forEach(cell => {
        cell.classList.remove('selected');
      });

      const dayCells = document.querySelectorAll('.day-cell:not(.empty)');
      const selectedCell = dayCells[day - 1];
      if (selectedCell) {
        selectedCell.classList.add('selected');
      }

      // Generate time slots for selected date
      generateTimeSlots();
    }

    // Select time
    function selectTime(time, element) {
      selectedTime = time;

      // Update selection
      document.querySelectorAll('.time-slot').forEach(slot => {
        slot.classList.remove('selected');
      });

      element.classList.add('selected');
    }

    // Select duration
    function selectDuration(minutes) {
      selectedDuration = minutes;

      // Update selection
      document.querySelectorAll('.duration-option').forEach(option => {
        option.classList.remove('selected');
      });

      event.target.classList.add('selected');
    }

    // Select session type
    function selectSessionType(type) {
      selectedSessionType = type;

      // Update selection
      document.querySelectorAll('.session-type').forEach(sessionType => {
        sessionType.classList.remove('selected');
      });

      event.currentTarget.classList.add('selected');
    }

    // Load upcoming sessions
    async function loadUpcomingSessions() {
      const sessionsList = document.getElementById('sessionsList');
      const userId = localStorage.getItem('skillSwapUserId');
      if (!userId) return;

      try {
        const response = await fetch(`/api/sessions/${userId}`);
        if (response.ok) {
          const sessions = await response.json();
          sessionsList.innerHTML = ''; // Clear early

          if (sessions.length === 0) {
            sessionsList.innerHTML = '<p style="text-align:center; padding:20px; color:#666;">No upcoming sessions scheduled yet.</p>';
            return;
          }

          sessions.forEach(session => {
            const isTeacher = session.teacher_id == userId;
            const partnerName = isTeacher ? session.learner_name : session.teacher_name;
            const roleText = isTeacher ? 'Teaching' : 'Learning';

            // Format session object for createSessionCard
            const sessionData = {
              id: session.id,
              title: `${session.subject} Session`,
              date: new Date(session.created_at.replace(' ', 'T')).toLocaleDateString() + ' (Accepted)',
              duration: "1 hour",
              type: roleText,
              subject: session.subject,
              language: "English",
              partner: partnerName,
              roomId: `${session.subject.toLowerCase().replace(/ /g, '-')}-${session.id}`
            };
            const sessionCard = createSessionCard(sessionData);
            sessionsList.appendChild(sessionCard);
          });
        }
      } catch (e) {
        console.error("Error loading sessions", e);
      }
    }

    // Load session history (Placeholder - backend doesn't have history yet)
    function loadSessionHistory() {
      const sessionHistory = document.getElementById('sessionHistory');
      sessionHistory.innerHTML = '<p style="text-align:center; padding:20px; color:#666;">No past sessions found.</p>';
    }

    // Create session card
    function createSessionCard(session) {
      const card = document.createElement('div');
      card.className = 'session-card';

      card.innerHTML = `
        <div class="session-header">
          <div class="session-title">${session.title} ${session.partner ? `with ${session.partner}` : ''}</div>
          <div class="session-date">${session.date}</div>
        </div>
        
        <div class="session-details">
          <div class="detail-item">
            <i class="fas fa-clock detail-icon"></i>
            <span>${session.duration}</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-book detail-icon"></i>
            <span>${session.subject}</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-language detail-icon"></i>
            <span>${session.language}</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-user detail-icon"></i>
            <span>${session.type}</span>
          </div>
        </div>
        
        <div class="session-actions">
          ${session.status === 'completed' ?
          '<button class="action-btn join-btn">Review Session</button>' :
          `<button class="action-btn join-btn" onclick="window.location.href='videocall.html?roomId=${session.roomId}'">
            <i class="fas fa-video"></i> Join Classroom
          </button>`
        }
          <button class="action-btn cancel-btn">Cancel</button>
        </div>
      `;

      return card;
    }

    // Schedule session
    function scheduleSession() {
      // Validate inputs
      if (!selectedDate || !selectedTime) {
        alert('Please select a date and time for your session.');
        return;
      }

      const subject = document.getElementById('subjectSelect').value;
      const title = document.getElementById('sessionTitle').value;
      const description = document.getElementById('sessionDescription').value;
      const language = document.getElementById('languageSelect').value;

      if (!subject || !title) {
        alert('Please fill in all required fields.');
        return;
      }

      // Create session object
      const session = {
        id: Date.now(),
        title: title,
        description: description,
        subject: subject,
        type: selectedSessionType === 'teach' ? 'Teaching' : 'Learning',
        date: selectedDate,
        time: selectedTime,
        duration: selectedDuration,
        language: language,
        status: 'scheduled',
        createdAt: new Date().toISOString()
      };

      // Save to localStorage (in real app, send to backend)
      try {
        let sessions = JSON.parse(localStorage.getItem('swapSkillSessions') || '[]');
        sessions.push(session);
        localStorage.setItem('swapSkillSessions', JSON.stringify(sessions));
      } catch (e) {
        console.log("Error saving session:", e);
      }

      // Show success message
      alert(`Session scheduled successfully for ${selectedDate.toLocaleDateString()} at ${selectedTime}!`);

      // Reset form
      resetForm();

      // Reload upcoming sessions
      document.getElementById('sessionsList').innerHTML = '';
      loadUpcomingSessions();
    }

    // Reset form
    function resetForm() {
      selectedDate = null;
      selectedTime = null;
      selectedDuration = 60;

      document.getElementById('selectedDateDisplay').textContent = 'Select a date';
      document.getElementById('sessionTitle').value = '';
      document.getElementById('sessionDescription').value = '';

      document.querySelectorAll('.day-cell').forEach(cell => {
        cell.classList.remove('selected');
      });

      document.querySelectorAll('.time-slot').forEach(slot => {
        slot.classList.remove('selected');
      });

      document.querySelectorAll('.duration-option').forEach(option => {
        option.classList.remove('selected');
      });

      // Reset to default duration
      document.querySelectorAll('.duration-option')[2].classList.add('selected'); // 60 min
    }
  </script>
</body>

</html>